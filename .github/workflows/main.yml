<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>åšä¹³å°ä¸ƒæ¨¡æ‹Ÿå™¨</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background: #f5f0f2; overflow: hidden; touch-action: none; display: flex; justify-content: center; align-items: center; min-height: 100vh; }
        #gameCanvas { width: 700px; height: 525px; background: #fff; display: block; border: 3px solid #ffccd5; border-radius: 12px; box-shadow: 0 5px 15px rgba(255,204,213,0.3); }
        #milkBtn { position: fixed; bottom: 60px; left: 50%; transform: translateX(-50%); width: 180px; height: 70px; background: linear-gradient(135deg, #ff9f43, #ff6b6b); border: none; border-radius: 35px; color: white; font-size: 30px; font-weight: bold; text-shadow: 1px 1px 3px rgba(0,0,0,0.2); display: none; cursor: pointer; box-shadow: 0 6px 18px rgba(255,107,107,0.4); transition: all 0.1s ease; z-index: 10; }
        #milkBtn:active { transform: translateX(-50%) scale(0.95); box-shadow: 0 4px 12px rgba(255,107,107,0.3); }
        #hpBar { position: fixed; top: 40px; left: 50%; transform: translateX(-50%); width: 320px; height: 32px; background: rgba(0,0,0,0.15); border-radius: 16px; overflow: hidden; z-index: 10; }
        #hpFill { width: 100%; height: 100%; background: linear-gradient(90deg, #4ecdc4, #45b7aa); transition: width 0.2s ease; }
        #hpText { position: fixed; top: 42px; left: 50%; transform: translateX(-50%); color: white; font-size: 18px; font-weight: bold; text-shadow: 1px 1px 2px rgba(0,0,0,0.5); z-index: 11; }
        #attackTip { position: fixed; top: 12%; left: 50%; transform: translateX(-50%); color: #e74c3c; font-size: 32px; font-weight: bold; text-shadow: 2px 2px 4px rgba(0,0,0,0.2); display: none; z-index: 10; }
        #killTip { position: fixed; top: 40%; left: 50%; transform: translateX(-50%); color: #d63031; font-size: 40px; font-weight: bold; text-shadow: 3px 3px 6px rgba(0,0,0,0.3); display: none; z-index: 20; }
        #countTip { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); color: #ff4757; font-size: 42px; font-weight: bold; text-shadow: 3px 3px 8px rgba(0,0,0,0.3); display: none; opacity: 0; transition: opacity 0.3s ease; z-index: 30; }
    </style>
</head>
<body>
    <canvas id="gameCanvas" width="700" height="525"></canvas>
    <div id="hpBar">
        <div id="hpFill"></div>
    </div>
    <div id="hpText">5000/5000</div>
    <button id="milkBtn">åå…¥</button>
    <div id="attackTip">å°ä¸ƒæ­£åœ¨ç”¨åŠ›å¤¹ä½ä½ ğŸ¥µ</div>
    <div id="killTip">ä½ è¢«å°ä¸ƒå¤¹æ–­äº†ğŸ˜±</div>
    <div id="countTip"></div>
    <script>
        const game = {
            canvas: document.getElementById('gameCanvas'),
            ctx: document.getElementById('gameCanvas').getContext('2d'),
            milkBtn: document.getElementById('milkBtn'),
            hpFill: document.getElementById('hpFill'),
            hpText: document.getElementById('hpText'),
            attackTip: document.getElementById('attackTip'),
            killTip: document.getElementById('killTip'),
            countTip: document.getElementById('countTip'),
            config: {
                playerSpeed: 8,
                playerHp: 5000,
                triggerMilkDistance: 130,
                attackValidDistance: 170,
                attackDuration: 5000,
                attackDamage: 78.1391, // ä¼¤å®³é™è‡³78.1391ï¼ˆåŸ250â†’78.1391ï¼‰
                xiaoqiMoveSpeed: 2.5, // é€Ÿåº¦é™è‡³2.5ï¼ˆåŸ4.0â†’3.0ï¼‰
                killProbability: 0.10, // ç§’æ€æ¦‚ç‡å¾®è°ƒè‡³10%
                countTipDuration: 1500,
                doubleTapTime: 300 // åŒå‡»åˆ¤å®šæ—¶é—´ï¼ˆ300mså†…ä¸¤æ¬¡ç‚¹å‡»ï¼‰
            },
            player: {
                x: 150, y: 260, size: 48, hp: 0, targetX: 150, targetY: 260
            },
            xiaoqi: {
                x: 480, y: 260, size: 48, state: 'normal',
                attackTimer: 0, lastAttackTime: 0,
                milkCount: 0,
                moveDirX: (Math.random() - 0.5) * 2.0
            },
            touch: {
                isTouching: false, touchX: 0, touchY: 0,
                lastTapTime: 0, // è®°å½•ä¸Šä¸€æ¬¡ç‚¹å‡»æ—¶é—´ï¼ˆåŒå‡»åˆ¤å®šç”¨ï¼‰
                lastTapX: 0, lastTapY: 0 // è®°å½•ä¸Šä¸€æ¬¡ç‚¹å‡»ä½ç½®
            },
            scaleRatio: 1,
            isGameOver: false
        };
        function initGame() {
            game.player.hp = game.config.playerHp;
            updateHpDisplay();
            
            const canvasRect = game.canvas.getBoundingClientRect();
            game.scaleRatio = canvasRect.width / game.canvas.width;
            
            // ç©å®¶è§¦æ‘¸æ§åˆ¶+åŒå‡»å°ä¸ƒåˆ¤å®š
            game.canvas.addEventListener('touchstart', (e) => {
                if (game.isGameOver) return;
                const touch = e.touches[0];
                const rect = game.canvas.getBoundingClientRect();
                // è½¬æ¢è§¦æ‘¸åæ ‡ä¸ºæ¸¸æˆç”»å¸ƒåæ ‡
                const tapX = (touch.clientX - rect.left) / game.scaleRatio;
                const tapY = (touch.clientY - rect.top) / game.scaleRatio;
                const currentTime = Date.now();
                // åŒå‡»åˆ¤å®šï¼š300mså†…ã€ç‚¹å‡»ä½ç½®åœ¨å°ä¸ƒèŒƒå›´å†…
                if (currentTime - game.touch.lastTapTime <= game.config.doubleTapTime) {
                    const distanceToXiaoqi = getDistance(tapX, tapY, game.xiaoqi.x, game.xiaoqi.y);
                    if (distanceToXiaoqi <= game.xiaoqi.size) {
                        // åŒå‡»å°ä¸ƒè§¦å‘åå…¥æ•ˆæœï¼ˆåŒæŒ‰é’®é€»è¾‘ï¼‰
                        useMilk();
                        game.touch.lastTapTime = 0; // é‡ç½®åŒå‡»çŠ¶æ€
                        return;
                    }
                }
                // éåŒå‡»ï¼šæ›´æ–°ç©å®¶ç›®æ ‡ä½ç½®+è®°å½•ç‚¹å‡»ä¿¡æ¯
                game.touch.touchX = tapX;
                game.touch.touchY = tapY;
                game.touch.isTouching = true;
                game.player.targetX = tapX;
                game.player.targetY = tapY;
                // è®°å½•æœ¬æ¬¡ç‚¹å‡»æ—¶é—´å’Œä½ç½®
                game.touch.lastTapTime = currentTime;
                game.touch.lastTapX = tapX;
                game.touch.lastTapY = tapY;
            });
            game.canvas.addEventListener('touchmove', (e) => {
                if (game.isGameOver || !game.touch.isTouching) return;
                e.preventDefault();
                const touch = e.touches[0];
                const rect = game.canvas.getBoundingClientRect();
                game.player.targetX = (touch.clientX - rect.left) / game.scaleRatio;
                game.player.targetY = (touch.clientY - rect.top) / game.scaleRatio;
            });
            game.canvas.addEventListener('touchend', () => {
                game.touch.isTouching = false;
            });
            // åå…¥æŒ‰é’®ç‚¹å‡»é€»è¾‘ï¼ˆä¿ç•™ï¼‰
            game.milkBtn.addEventListener('click', useMilk);
            
            requestAnimationFrame(gameLoop);
        }
        // åå…¥æ ¸å¿ƒé€»è¾‘ï¼ˆæŒ‰é’®+åŒå‡»å°ä¸ƒå…±ç”¨ï¼‰
        function useMilk() {
            if (game.xiaoqi.state === 'attack' || game.isGameOver) return;
            game.xiaoqi.state = 'attack';
            game.xiaoqi.attackTimer = game.config.attackDuration;
      
